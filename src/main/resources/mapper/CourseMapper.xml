<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ac.kr.academy.mapper.course.CourseMapper">
    <resultMap id="CourseResultMap" type="com.ac.kr.academy.domain.course.Course">
        <id property="id" column="id"/>
        <result property="place" column="place"/>
        <result property="dayOfWeek" column="day_of_week"/>
        <result property="stratPeriod" column="strat_period"/>
        <result property="endPeriod" column="end_period"/>
        <result property="capacity" column="capacity"/>
        <result property="semesterId" column="semester_id"/>
        <result property="subjectId" column="subject_id"/>
    </resultMap>

    <!-- 강의 개설 -->
   <insert id="insert" parameterType="com.ac.kr.academy.domain.course.Course">
       <selectKey keyProperty="id" order="BEFORE" resultType="long">
           SELECT course_seq.NEXTVAL FROM dual
       </selectKey>
           INSERT INTO course (
       id, place, day_of_week, strat_period, end_period, capacity, semester_id, subject_id
       )
            VALUES (
       #{id}, #{place}, #{dayOfWeek}, #{stratPeriod}, #{endPeriod}, #{capacity}, #{semesterId}, #{subjectId}
       )
   </insert>

    <!-- 강의 목록 조회 -->
    <select id="findAll" resultType="CourseResultMap">
        SELECT *
        FROM course
        WHERE course_id = #{courseId}
        ORDER BY id DESC
    </select>

    <!-- 강의 단건 조회 -->
    <select id="findById" resultMap="CourseResultMap">
        SELECT c.*, subject_id AS subject_name
        FROM course c
            JOIN subject s ON c.subject_id = s.id
        WHERE c.id = #{id}
    </select>

    <!-- 강의 수정 -->
    <update id="update">
        UPDATE course
        SET course = #{course}
        WHERE id = #{id}
    </update>

    <!-- 강의 삭제 -->
    <delete id="delete">
        DELETE FROM course WHERE id = #{id}
    </delete>
</mapper>
